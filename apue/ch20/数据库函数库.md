# 数据库函数库

![1573786651140](数据库函数库.assets/1573786651140.png)

![1573786683798](数据库函数库.assets/1573786683798.png)

## 20.3 函数库

> #include "apue_db.h"

### db_open db_close

```c++
DBHANDLE db_open(const char *pathname, int oflag,.../* int mode */);
		// 返回值： 若成功，返回数据库句柄；若失败，返回NULL
void db_close(DBHANDLE db);
```

![1573787517190](数据库函数库.assets/1573787517190.png)

### db_store 存入

```c++
int db_store(DBHANDLE db, const char *key, const char *data, int flag);
			//返回值： 成功返货0， 出错返回非0值（见下）
```

![1573787792860](数据库函数库.assets/1573787792860.png)

![1573787895679](数据库函数库.assets/1573787895679.png)

### db_fetch 获取



![1573788519548](数据库函数库.assets/1573788519548.png)

### db_delete 删除

![1573788589989](数据库函数库.assets/1573788589989.png)

### db_rewind db_nextrec 逐条访问

![1573788719855](数据库函数库.assets/1573788719855.png)

## 20.4 实现概述

*有许多技术可用来组织索引文件以提高按键查询的速度和效率，**散列表和B+树**是两种常用的技术。*

**采用固定大小的散列表来组织索引文件组织，并采用链表法解决散列冲突。**

![1573789266396](数据库函数库.assets/1573789266396.png)

![1573789278875](数据库函数库.assets/1573789278875.png)

### 实现结构

![1573789379988](数据库函数库.assets/1573789379988.png)

![1573789415005](数据库函数库.assets/1573789415005.png)

## 20.5 集中式或非集中式

>1.集中式
>
>2.非集中式

![1573800002896](数据库函数库.assets/1573800002896.png)

![1573800231453](数据库函数库.assets/1573800231453.png)



![1573800269062](数据库函数库.assets/1573800269062.png)

**调用数据库库函数执行I/O的用户进程是合作进程，他们使用字节范围记录锁机制来实现并发控制。**

## 20.6 并发

> 1 粗粒度锁
>
> 2 细粒度锁

![1573801122564](数据库函数库.assets/1573801122564.png)

![1573801134781](数据库函数库.assets/1573801134781.png)

![1573801150756](数据库函数库.assets/1573801150756.png)

## 20.9 性能

> 不加锁 
>
> 建议性锁
>
> 强制性锁

